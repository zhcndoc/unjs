---
title: å®£å¸ƒ Nitro 2.6
description: æœ€æ–°çš„ Nitro æ›´æ–°å¸¦æ¥äº†åŸç”Ÿå“åº”æµæ”¯æŒã€é”™è¯¯æ•è·å’Œç”Ÿå‘½å‘¨æœŸé’©å­ã€æ›´å¥½çš„ CLI ä½“éªŒç­‰ï¼
authors:
  - name: Pooya Parsa
    picture: https://github.com/pi0.png
    twitter: _pi0_
categories:
  - nitro
  - release
packages:
  - nitro
publishedAt: 2023-08-25
modifiedAt: 2023-08-25
---

åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å¯ä»¥æ¢ç´¢ [Nitro](https://nitro.unjs.io) çš„æœ€æ–°æ›´æ–°ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¹³å°æ— å…³çš„æœåŠ¡å™¨ç«¯å’Œåç«¯åº”ç”¨ç¨‹åºçš„å¼ºå¤§å·¥å…·ã€‚[Nitro](https://nitro.unjs.io) ä¸º [Nuxt](https://nuxt.com) æä¾›äº†æ”¯æŒï¼Œå¹¶ä¸”å¯¹æ‰€æœ‰äººéƒ½æ˜¯å¯ç”¨çš„ï¼

## ğŸŒŠ åŸç”Ÿå“åº”æµ

Nitro 2.6 åŒ…æ‹¬ [h3](https://h3.unjs.io) 1.8ï¼Œæ”¯æŒåŸç”Ÿ [Web Streams](https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream) å’Œ [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response)ã€‚å®ƒè¿˜åŒ…æ‹¬è¿è¡Œæ—¶å’Œç±»å‹å®‰å…¨çš„è¯·æ±‚éªŒè¯å·¥å…·ã€åŸºäºå¯¹è±¡æ ¼å¼çš„äº‹ä»¶å¤„ç†ç¨‹åºä»¥åŠå…¶ä»–åŠŸèƒ½ï¼

:another-article{link="/blog/2023-08-15-h3-towards-the-edge-of-the-web"}

Web Streams ç°åœ¨æ”¯æŒ [Node.js](https://nodejs.org/en)ã€[Bun](https://bun.sh)ã€[Deno](https://deno.com/)ã€[Cloudflare Workers](https://workers.cloudflare.com/) å’Œ [Vercel](https://vercel.com)ã€‚å¯¹äºä¸å…¼å®¹çš„å¹³å°ï¼ŒNitro è‡ªåŠ¨è¯»å–å®Œæ•´çš„æµ([#1624](https://github.com/unjs/nitro/pull/1624))ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå…¼å®¹çš„æ ¼å¼ã€‚æˆ‘ä»¬æ­£åœ¨ç´§å¯†åˆä½œï¼Œä»¥æ‰©å±•æ‰€æœ‰å±‚ä¸Šçš„æµæ”¯æŒã€‚

## ğŸ“¦ è¿è¡Œæ—¶å¯†é’¥å…¼å®¹çš„å¯¼å‡ºæ¡ä»¶

Nitro 2.6 ç°åœ¨è‡ªåŠ¨æ ¹æ® [Runtime Keys Proposal](https://runtime-keys.proposal.wintercg.org/) ([#1401](https://github.com/unjs/nitro/pull/1401)) æ·»åŠ å¯¼å‡ºæ¡ä»¶ã€‚

ä½¿ç”¨å¹³å°å¯¼å‡ºæ¡ä»¶ï¼ŒNitro å¯ä»¥æ™ºèƒ½åœ°ä½¿ç”¨æ‚¨é¡¹ç›®åº“çš„é€‚å½“æ„å»ºï¼Œä¸ºæ¯ä¸ªéƒ¨ç½²ç›®æ ‡ã€‚Unjs åŒ…å¼•å…¥äº†ä¸è¿è¡Œæ—¶é”®å…¼å®¹çš„æ¡ä»¶ï¼Œä¾‹å¦‚ [unjs/node-fetch-native](https://node-fetch-native.unjs.io) å’Œ [unjs/ofetch](https://ofetch.unjs.io)ï¼Œå¹¶æ—¨åœ¨åœ¨æ›´å¤šåŒ…ä¸­æ ‡å‡†åŒ–è¿™ç§æ–¹æ³•ã€‚

å¯¹äºé«˜çº§ç”¨ä¾‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `exportConditions` æ ‡å¿—è¦†ç›–å¯¼å‡ºæ¡ä»¶ã€‚

## ğŸ§© å¼‚æ­¥ä¸Šä¸‹æ–‡å’Œç»„åˆ API

Nitro 2.6 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å®éªŒæ€§ `useEvent()` APIï¼Œä½¿è¯·æ±‚äº‹ä»¶å¯ä»¥åœ¨æ‰€æœ‰å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­å¯ç”¨ï¼Œè€Œä¸éœ€è¦æ˜¾å¼åœ°å°†å®ƒä»¬ä¼ é€’ç»™æ‰€æœ‰å‡½æ•°ä½œä¸ºå‚æ•° ([#1546](https://github.com/unjs/nitro/pull/1546))ã€‚

è¿™é‡Šæ”¾äº†ä¸€ä¸ªæ–°çš„å¼ºå¤§è®¾è®¡æ¨¡å¼ï¼Œä½¿æœåŠ¡å™¨äº‹ä»¶åœ¨ä»»æ„å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­å¯ç”¨ï¼Œä½¿ç”¨ `useEvent()`ã€‚è¿™ä¸ªç‰¹æ€§å—åˆ° [Vue Composition API](https://vuejs.org/guide/extras/composition-api-faq.html) çš„å¯å‘ï¼Œç”± [unjs/unctx](https://unctx.unjs.io) æä¾›æ”¯æŒã€‚

æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® `experimental.asyncContext: true` å¯ç”¨æ­¤åŠŸèƒ½ã€‚

**æ³¨æ„ï¼š** ç›®å‰ï¼Œæ­¤åŠŸèƒ½ä»…æ”¯æŒ Bun å’Œ Node.js ç¯å¢ƒï¼Œå®ƒä»¬æ”¯æŒ `AsyncLocalStorage`ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ ¹æ® [AsyncContext ææ¡ˆ](https://github.com/tc39/proposal-async-context)å¢åŠ å¹³å°è¦†ç›–èŒƒå›´ã€‚

## ğŸš€ æ†ç»‘è¿è¡Œæ—¶ä¾èµ–é¡¹

åœ¨æ„å»ºç”Ÿäº§åº”ç”¨ç¨‹åºæ—¶ï¼ŒNitro ä½¿ç”¨äº†ä¸€ä¸ªåä¸º [vercel/nft](https://github.com/vercel/nft) çš„å·¥å…·ï¼Œä»¥è·Ÿè¸ª `node_modules` æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬å¤åˆ¶åˆ° `.output/server/node_modules` æ–‡ä»¶å¤¹ä¸­ã€‚è¿™ç§æ–¹æ³•æœ‰ä¸€äº›ä¼˜ç‚¹ï¼Œæ¯”å¦‚å¾ˆå¥½åœ°ä¸ä¸èƒ½ç”¨ [rollup](https://rollupjs.org/) æ†ç»‘çš„æœ¬åœ°æ¨¡å—å·¥ä½œã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼š

- å¤åˆ¶åˆ°è¾“å‡ºç›®å½•ä¸­çš„é¢å¤–æ•°æ®ï¼Œå¦‚ `package.json` æ–‡ä»¶ã€‚
- ç”±äº `node_modules` è§£æå¯¼è‡´çš„å¯åŠ¨å¼€é”€å¢åŠ ã€‚
- é€šè¿‡æ–‡ä»¶çº§åˆ«è€Œä¸æ˜¯é€å‡ºå£å¯¼å‡ºè¿›è¡Œæ ‘æ‘‡æ‘†ä¼˜åŒ–ã€‚
- å½“å­˜åœ¨å¤šä¸ªç‰ˆæœ¬æ—¶ï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯çš„å¯¼å‡ºæ¡ä»¶è§£æå’Œæå‡é—®é¢˜ã€‚

Nitro 2.6 ç°åœ¨è‡ªåŠ¨æ†ç»‘è‡ªå·±çš„ä¾èµ–é¡¹ï¼Œå¦‚ `h3`ã€`defu`ã€`hookable`ã€`ofetch` ç­‰ã€‚è™½ç„¶è®¸å¤šè¿™äº›éƒ½å¾ˆå°ä¸”ç´§å‡‘ï¼Œä½†æ†ç»‘å®ƒä»¬å¯¼è‡´æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼

åº¦é‡/æ¨¡å¼ | å¤–éƒ¨ä¾èµ–ï¼ˆ2.5ï¼‰ | æ†ç»‘ä¾èµ–ï¼ˆ2.6ï¼‰
----------------|---------------|------------------
æ–‡ä»¶æ•°é‡ | 60           | 9
ç£ç›˜å¤§å° | 508K | 292K
ç£ç›˜å¤§å°ï¼ˆgzipï¼‰ | 100Kb | 72Kb
å¯åŠ¨ | 34.7ms | 18ms
è·å– | 17.2 ms | 14.6ms
å¯åŠ¨åˆ°è·å– | 53.2ms | 34.7ms

ï¼ˆæ³¨æ„ï¼šåŸºå‡†æµ‹è¯•åœ¨ MBA M2 ä¸Šä½¿ç”¨ Node.js v18.16.1 è¿›è¡Œã€‚å‚è€ƒ [#1554](https://github.com/unjs/nitro/pull/1554) äº†è§£åŸºå‡†æµ‹è¯•è„šæœ¬çš„è¯¦ç»†ä¿¡æ¯ã€‚ï¼‰

å¦‚æœæ‚¨å‡ºäºä»»ä½•åŸå› éœ€è¦ä»¥å‰çš„è¡Œä¸ºï¼Œæ‚¨å¯ä»¥è®¾ç½® `experimental.bundleRuntimeDependencies: false` é…ç½®ã€‚

## ğŸª é”™è¯¯æ•è·å’Œç”Ÿæ´»å‘¨æœŸé’©å­

Nitro 2.6 å¼•å…¥äº†å¯¹ä¸¤ä¸ªæ–° API çš„æ”¯æŒï¼š`useNitroApp().captureError()` å’Œ `event.captureError()` ([#1463](https://github.com/unjs/nitro/pull/1463))ï¼Œå®ƒè‡ªåŠ¨æ•è·ç”Ÿå‘½å‘¨æœŸé”™è¯¯ï¼

æ‚¨å¯ä»¥ä½¿ç”¨ [Nitro æ’ä»¶](https://nitro.unjs.io/guide/plugins)æ¥æŒ‚é’©è‡ªåŠ¨æ•è·å’Œæ‰‹åŠ¨æ•è·çš„é”™è¯¯ã€‚è¿™ä½¿å¾—æ‚¨çš„è‡ªå®šä¹‰æ—¥å¿—åŸºç¡€è®¾æ–½çš„é›†æˆå˜å¾—å®¹æ˜“ã€‚

```ts
export default defineNitroPlugin((nitro) => {
  nitro.hooks.hook('error', async (error, { event }) => {
    console.error(`${event.path} Application error:`, error)
  })
})
```

æ­¤å¤–ï¼Œè¿˜å¼•å…¥äº†ä¸‰ä¸ªå…¨å±€é’©å­ï¼š`request`ã€`beforeResponse` å’Œ `afterResponse` ([#1545](https://github.com/unjs/nitro/pull/1545))ï¼Œå…è®¸é€šè¿‡ Nitro æ’ä»¶å…¨å±€æ‹¦æˆªè¯·æ±‚ç”Ÿå‘½å‘¨æœŸã€‚

```ts
export default defineNitroPlugin((nitroApp) => {
  nitroApp.hooks.hook('request', (event) => {
    console.log('on request', event.path)
  })

  nitroApp.hooks.hook('beforeResponse', (event, { body }) => {
    console.log('on response', event.path, { body })
  })

  nitroApp.hooks.hook('afterResponse', (event, { body }) => {
    console.log('on after response', event.path, { body })
  })
})
```

## ğŸ’¾ é»˜è®¤æŒä¹…æ•°æ®å­˜å‚¨

Nitro æä¾›äº†ä¸€ä¸ªçµæ´»çš„ [Key-Value å­˜å‚¨å±‚](https://nitro.unjs.io/guide/storage)ï¼Œç”± [unjs/unstorage](https://unstorage.unjs.io) æä¾›æ”¯æŒã€‚é»˜è®¤å­˜å‚¨åç«¯æ˜¯å†…å­˜ä¸­çš„ï¼Œæ‚¨å¯ä»¥åœ¨å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸­é…ç½®å¹¶ç»„åˆå¤šä¸ªå­˜å‚¨åç«¯ã€‚

Nitro åŒ…å«ä¸€ä¸ªæ ‡å‡†çš„ `cache:` å­˜å‚¨ï¼Œå®ƒåœ¨å¼€å‘æ—¶å†…éƒ¨ç”¨äº[ç¼“å­˜å±‚](https://nitro.unjs.io/guide/cache)å’Œ[ç¼“å­˜è·¯ç”±è§„åˆ™](https://nitro.unjs.io/guide/routing#route-rules)ã€‚åœ¨ Nitro 2.6 ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ ‡å‡†æŒä¹…å­˜å‚¨ï¼Œ`data:` ([#1352](https://github.com/unjs/nitro/pull/1352))ã€‚è¿™é€‚ç”¨äº Node.js å…¼å®¹çš„è¿è¡Œæ—¶é¢„è®¾çš„å¼€å‘å’Œç”Ÿäº§æ¨¡å¼ã€‚

ä¸ºäº†æœ€å°åŒ– bundle å¤§å°ï¼Œæˆ‘ä»¬åœ¨ unstorage ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç´§å‡‘ä¸”é€‚åˆç”Ÿäº§ç¯å¢ƒçš„[`fs-lite`é©±åŠ¨](https://unstorage.unjs.io/drivers/fs#nodejs-filesystem-lite)ã€‚æ•°æ®å°†å­˜å‚¨åœ¨é¡¹ç›®ä¸­æ–°çš„ `.data/kv` ç›®å½•ä¸­ï¼Œå¹¶åœ¨æ„å»ºä¹‹é—´ä¿æŒæŒä¹…ã€‚å®ƒå·²ç»å‡†å¤‡å¥½ä½¿ç”¨ `useStorage('data')` ä½¿ç”¨ï¼Œæ‚¨æ€»æ˜¯å¯ä»¥é…ç½® `data:` æŒ‚è½½ç‚¹ï¼Œå¹¶å°†å…¶åœ¨è¿è¡Œæ—¶ä½¿ç”¨ï¼

## ğŸ—ºï¸ æ›´è½»çš„æºåœ°å›¾

åœ¨ Nitro 2.6 ä¸­ï¼Œå·²åˆ é™¤çš„é—ç•™ [`source-map-support`polyfill](https://www.npmjs.com/package/source-map-support)ï¼Œå¹¶ä¸”å·²ç»å¼•å…¥äº†ä¸€ä¸ªä¼˜åŒ–ï¼Œè‡ªåŠ¨åœ¨ `.output/server` ç›®å½•ä¸­å»é™¤åº“ä¸­çš„ `node_modules` ç›®å½•ä¸­çš„å†…å®¹æ˜ å°„æ¡ç›®ã€‚è¿™äº›æ›´æ”¹æ˜¾è‘—æœ‰åŠ©äºå‡å°‘ç”Ÿäº§ bundle å¤§å°ã€‚

ä¸ºäº†åˆ©ç”¨ Node.js çš„æœ¬åœ°æºåœ°å›¾æ”¯æŒï¼Œæ‚¨å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ `NODE_OPTIONS=--enable-source-maps`ã€‚åœ¨å³å°†å‘å¸ƒçš„ Nuxt å’Œ Nitro CLI ç‰ˆæœ¬ä¸­ï¼Œè¿™å°†è‡ªåŠ¨ä¸º `nitro build` å¯ç”¨ `--minify`/`--no-minify` å‚æ•°ã€‚

å¦‚æœæ‚¨éœ€è¦ç¦ç”¨æ–°çš„ä¼˜åŒ–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `experimental.sourcemapMinify: false` æ ‡å¿—ã€‚

## ğŸ’» æ›´å¥½çš„ CLI ä½“éªŒ

Nitro CLI ç°åœ¨æ”¯æŒ `--preset` å‚æ•°å’Œ `--minify`/`--no-minify` å‚æ•°ã€‚

æœ€æ–°çš„ nitro CLI éšé™„æœ‰æœ€æ–°çš„ [unjs/listhen](https://listhen.unjs.io)ï¼Œå®ƒå…·æœ‰ç”± [unjs/untun](https://untun.unjs.io) å’Œ [unjs/uqr](https://uqr.unjs.io) æä¾›æ”¯æŒçš„ Cloudflare Quick Tunnels(`--tunnel`)å’Œ QR æ”¯æŒ(`--host --qr`)ã€‚

å¼€å‘æœåŠ¡å™¨å·²ç»è¿ç§»åˆ°ä½¿ç”¨ [unjs/httpxy](https://httpxy.unjs.io)ï¼Œè¿™æ˜¯ `http-proxy` çš„ TypeScript åˆ†æ”¯ã€‚è¿™ä¸€ä¸¾åŠ¨æ—¨åœ¨ä¸ºæœªæ¥æé«˜æ€§èƒ½å’Œç¨³å®šæ€§ã€‚

## ğŸ”¥ Firebase ç¬¬äºŒä»£é¢„è®¾

æ„Ÿè°¢ç¤¾åŒºçš„å¤§é‡åŠªåŠ›ï¼ŒNitro ç°åœ¨æ”¯æŒ Firebase ç¬¬äºŒä»£é¢„è®¾ ([#1500](https://github.com/unjs/nitro/pull/1500))ã€‚

è™½ç„¶é»˜è®¤ç›®æ ‡ä»ç„¶æ˜¯ v1ï¼Œä½†æˆ‘ä»¬å¼ºçƒˆå»ºè®®é€šè¿‡è®¾ç½® `firebase.gen: 2` é…ç½®ï¼ˆ[äº†è§£æ›´å¤š](https://nitro.unjs.io/deploy/providers/firebase#using-2nd-generation-firebase-functions)ï¼‰æ¥è¿ç§»ã€‚

## ğŸ”“ å‡çº§åˆ° 2.6

å‡çº§æ—¶ï¼Œè¯·ç¡®ä¿æ›´æ–°é¡¹ç›®åŒ…ç®¡ç†å™¨çš„é”æ–‡ä»¶å’Œ `node_modules` ç›®å½•ï¼Œä»¥é¿å…æ‰˜ç®¡é—®é¢˜ã€‚

## âœ¨ å…¶ä»–æ”¹è¿›

- å¤±è´¥é¢„æ¸²æŸ“è·¯çº¿çš„æ§åˆ¶å°è¾“å‡ºæ ¼å¼å·²ç»æ”¹è¿›ã€‚([#1471](https://github.com/unjs/nitro/pull/1471))
- `event.waitUntil` API ä¸ Cloudflare é›†æˆã€‚([#1421](https://github.com/unjs/nitro/pull/1421))
- æ”¯æŒ `ignore` ä»¥æ’é™¤æ‰«æçš„æ–‡ä»¶ã€‚([#1430](https://github.com/unjs/nitro/pull/1430))
- èƒ½å¤Ÿå¿½ç•¥å…¬å…±èµ„äº§ `ignore` é€‰é¡¹ã€‚([#945](https://github.com/unjs/nitro/pull/945))
- æ–° `iis` æœåŠ¡å™¨é¢„è®¾ã€‚([#1436](https://github.com/unjs/nitro/pull/1436))
- æ–° `prerender:config`ã€`prerender:init` å’Œ `prerender:done` é’©å­ã€‚([#1519](https://github.com/unjs/nitro/pull/1519))
- æ”¯æŒç¼“å­˜å…·æœ‰å˜é‡ `host` å’Œæ ‡å¤´çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚([#1184](https://github.com/unjs/nitro/pull/1184))
- æ”¯æŒé¢„æ¸²æŸ“æŸ¥è¯¢é“¾æ¥æ¢ç´¢ã€‚([#1474](https://github.com/unjs/nitro/pull/1474))
- æ”¯æŒé€šè¿‡ `NITRO_UNIX_SOCKET` ç›‘å¬ UNIX å¥—æ¥å­—ã€‚([#1201](https://github.com/unjs/nitro/pull/1201))
- Cookie æ ‡å¤´è‡ªåŠ¨åˆ†å‰²ã€‚([#1452](https://github.com/unjs/nitro/pull/1452))

è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ”¹è¿›å’Œä¿®å¤ã€‚æ‚¨å¯ä»¥åœ¨[å˜æ›´æ—¥å¿—](https://github.com/unjs/nitro/releases/tag/v2.6.0)ä¸­æ‰¾åˆ°è¯¦ç»†çš„é¡¹ç›®æ›´æ”¹åˆ—è¡¨ã€‚
